---
title: '렌더링에 관한 이야기'
parmalink : /study/2025-06-01-1
date: 2025-06-01
tags:
  - Optimigation	
  - Com2us TA Campus
---


> 아티스트의 파이프라인 탐험기

- CPU에서 하는 컬링 : 오브젝트 단위로 컬링
- GPU에서 하는 컬링 : 삼각형 단위로 컬링



## G-Buffer & C-Buffer

### G-Buffer

G 버퍼는 그래픽 렌더 파이프라인 중 한 단계로, 쉽계 표현해 촬영 현장의 정보가 담긴 기록지라고 표현할 수 있습니다. 예를 들어, 영화 한 장면을 찍는다고 했을때 이 정보를 모두 감독들은 따로 적어둡니다.

- 카메라 위치와 각도 -> 위치 정보
- 조명 방향 -> 노말 정보
- 배경 색감 -> 알베도
- 피사체 거리 -> Depth(깊이) 정보

이렇게 적어놓은 데이터들을 모아 둔 곳이 G 버퍼 입니다. 

G 버퍼는 렌더링을 두 번 안하고도, 한 번 저장해 두었던 정보들을 꺼내 또 렌더할때 이전 정보들을 가지고 다시 계산하거나 조절하기 쉽기 때문입니다. 보통 화면 포스트 프로세싱(화면 후처리 효과), Global Illumination 같은 화면 효과 연산에 사용됩니다. 보통 디퍼드 렌더링 (Deferred Rendering)에서 많이 사용 됩니다. 



#### G 버퍼가 모바일에서 무거운 이유?

G 버퍼는 보통 여러 개의 텍스처를 사용해 아래 정보를 나눠 저장합니다.

- Postion
- Normal
- Albedo
- Smoothness, Metallic 등

모바일 GPU는 동시에 여러 렌더를 타겟(MRT : Multiple Render Targets이라고도 칭함)하는 능력이 제한적입니다. 또, G 버퍼는 보통 HDR 포맷을 사용하기 때문에 저장 용량이 큰데, 모바일은 메모리 대역폭 또한 PC나 콘솔에 비해 낮기 때문에 메모리 병목 현상이 발생할 수 있습니다.



#### Single Pass Deferred 

이러한 문제들로 **Single Pass Deferred**라는 최적화 옵션이 존재합니다.

Single Pass Deferred는 기존 디퍼드 렌더링보다 메모리 사용량과 성능을 개선한 최적화 기법입니다. 이름 그대로 한번의 패스(Pass)로 모든 G 버퍼 정보를 그리는 기법입니다. 1개 텍스처에 압축해 정보를 저장하기 때문에 메모리를 적게 쓰기 때문에 성능 향상 효과가 있습니다.

단, 데이터를 압축해 저장하기 때문에 정밀도 손실이 발생할 수 있으며 하나의 텍스처에 여러 정보가 저장되다 보니 후처리, 셰이더 개발자 입장에선 불편한 구조라는 단점이 있습니다.







### C-Buffer

G 버퍼와 헷갈렸던 C 버퍼, C 버퍼는 무엇인가요?

커멘드 버퍼라고도 칭하는 C 버퍼는 명령 또는 커맨드를 저장하는 버퍼입니다. 쉽게 표현하면 렌더링 명령어들을 미리 적어두는 메모장이라고 할 수 있습니다. 렌더링 할 때마다 명령어를 일일이 싫애하는게 아니라, 미리 정리해놓고, 한번에 처리할 수 있도록 합니다. 이렇게 처리하면 더 빠르고 효율적으로 명령을 처리할 수 있습니다.

커맨드 버퍼를 사용하면, 이 명령 중간 중간에 작업자가 원하는 작업을 끼워 넣을 수 있습니다.

실제 사용을 예로 들면,

```csharp
// cb 이름의 커맨드 버퍼를 만들고,
CommandBuffer cb = new CommandBuffer();

// 화면 이미지를 myMaterial을 이용해 가공합니다.
cb.Blit(source, destination, myMaterial);

// AddCommandBuffer를 통해 이 작업이 카메라가 후처리를 끝낸 직후에 실행하도록 예약.
camera.AddCommandBuffer(CameraEvent.AfterImageEffects, cb);
```





|             | 효과                               | 커맨드 버퍼의 역할                                           |
| ----------- | ---------------------------------- | ------------------------------------------------------------ |
| 블러 (굴절) | 배경을 흐릿하게, 굴절 효과         | 굴절에 사용될 텍스처를 전달                                  |
| 데칼        | 메쉬 표면에 자국, 문양 등 덧그리기 | 데칼용 프로젝터 메쉬를 커맨드 버퍼에서 렌더링하고 이를 덮어씌울 오브젝트 표면에 덧그림 |

https://docs.unity3d.com/kr/2019.3/Manual/GraphicsCommandBuffers.html 참고



G 버퍼와 C 버퍼(커맨드 버퍼)는 결론적으로 완전 다른 기능입니다. 요약하자면

| G 버퍼                                  | C 버퍼                                    |
| --------------------------------------- | ----------------------------------------- |
| **데이터 저장용** (색상, 노멀, 깊이 등) | **명령 저장용** (이거 그려! 저거 복사해!) |
| 렌더링의 **결과**를 담음                | 렌더링을 **어떻게 할지** 계획을 담음      |





## 디퍼드 vs 포워드 렌더링

